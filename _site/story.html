<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hoang Huy, Li Ziyi, Hou Tao">

<title>ISSS608-VAA-Project - Storyboard - Loan Default Prediction in Nigeria</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ISSS608-VAA-Project</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">HOME</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html">
 <span class="menu-text">INTRODUCTION</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./story.html" aria-current="page">
 <span class="menu-text">STORY</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./rshiny.html">
 <span class="menu-text">RSHINY APP</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./poster.html">
 <span class="menu-text">POSTER</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach">Approach</a></li>
  <li><a href="#r-shiny-app" id="toc-r-shiny-app" class="nav-link" data-scroll-target="#r-shiny-app">R-Shiny App</a>
  <ul class="collapse">
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory data analysis (EDA)</a></li>
  <li><a href="#prototype-of-first-page" id="toc-prototype-of-first-page" class="nav-link" data-scroll-target="#prototype-of-first-page">PROTOTYPE OF FIRST PAGE</a></li>
  </ul></li>
  <li><a href="#deeper-dive" id="toc-deeper-dive" class="nav-link" data-scroll-target="#deeper-dive">Deeper Dive</a>
  <ul class="collapse">
  <li><a href="#multi--collinearity-curse" id="toc-multi--collinearity-curse" class="nav-link" data-scroll-target="#multi--collinearity-curse">Multi- Collinearity Curse</a></li>
  <li><a href="#quasi-complete-separation" id="toc-quasi-complete-separation" class="nav-link" data-scroll-target="#quasi-complete-separation">Quasi Complete Separation</a></li>
  <li><a href="#loan-default-prediction-using-classification-algorithms" id="toc-loan-default-prediction-using-classification-algorithms" class="nav-link" data-scroll-target="#loan-default-prediction-using-classification-algorithms">Loan default prediction using classification algorithms</a>
  <ul class="collapse">
  <li><a href="#tidymodels" id="toc-tidymodels" class="nav-link" data-scroll-target="#tidymodels">Tidymodels</a></li>
  <li><a href="#loan-type" id="toc-loan-type" class="nav-link" data-scroll-target="#loan-type">Loan Type</a></li>
  <li><a href="#algorithms" id="toc-algorithms" class="nav-link" data-scroll-target="#algorithms">Algorithms</a></li>
  <li><a href="#data-sampling" id="toc-data-sampling" class="nav-link" data-scroll-target="#data-sampling">Data Sampling</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Storyboard - Loan Default Prediction in Nigeria</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hoang Huy, Li Ziyi, Hou Tao </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 11, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="background" class="level1">
<h1>Background</h1>
<p>Loan lending offers substantial profits, but also carries the risk of customers failing to repay loans on time, known as loan default risk, which is a type of credit risk.</p>
<p>To manage uncertainty, lending institutions have established lending standards and created predictive models to better evaluate the likelihood of loan repayment through credit risk assessment of customers.</p>
<p>Over the past thirty years, loan default risk assessment has progressed from traditional credit scoring systems to data modeling utilizing data analytics and machine learning techniques.</p>
</section>
<section id="motivation" class="level1">
<h1>Motivation</h1>
<p>This project aims to explore R technologies to develop reusable solutions (such as R-shiny application), to support users to perform data exploration, analysis, and prediction from set of customer variables to select the optimal variables to perform the customer loan default prediction.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The data that we are using, is from Data Science Nigeria Challenge #1: Loan Default Prediction.</p>
<p>There are two types of risk models in general:</p>
<ul>
<li><p>1st new business risk, which would be used to assess the risk of application(s) associated with the first loan that he/she applies.</p></li>
<li><p>2nd repeat or behavior risk model, in which case the customer has been a client and applies for a repeat loan.</p></li>
</ul>
<p>Overall, we can split the data into 2 main subsets of data: For Single Loans or Repeat Loans based on number of loans per customer in the data.</p>
</section>
<section id="approach" class="level1">
<h1>Approach</h1>
<p>To effectively predict the customer loan default, this study aims to provide following approaches to explore, analysis, mining factors are important to evaluate loan default.</p>
<ul>
<li>Loan default factor exploration: it provides visualization on all or selected factors, to allow users to understand the trends of the variables, correlation of variables between each other.</li>
<li>Loan default factor mining: it provides deep dive analysis for customer further analysis the importance of loan default factors for prediction.</li>
<li>Loan default prediction: it provides interfaces for users to select variables, sampling methods, and predictive algorithms to model and analyze factors for customer loan default prediction.</li>
</ul>
</section>
<section id="r-shiny-app" class="level1">
<h1>R-Shiny App</h1>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory data analysis (EDA)</h2>
<p>This is the first part of the R-Shiny application where users can perform Exploratory Data Analysis on this dataset, with the more common tools such as Distribution Analysis , Deviation Analysis and Scatterplot.</p>
<p>Distribution analysis is a statistical technique used to assess the symmetry and shape of a dataset. It involves examining the frequency distribution of a predictor variable to identify whether the data is normally distributed or skewed. If a variable is found to be highly skewed, this can impact the accuracy and reliability of statistical models, and may require data transformation or specialized modeling techniques.</p>
<p>Example:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Barchart-showing-the-normal-distribution-a-distribution-which-is-positively-skewed-and-a.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Another tool can be employed is Deviation Analysis (box plot). Deviation analysis, often performed through box plots, is a graphical technique used to examine the relationship between a categorical predictor variable and a continuous variable. It provides a visual representation of the distribution of the continuous variable within each category of the predictor, and can reveal differences in variability or central tendency between groups. This can aid in identifying potential correlations between the two predictors and inform subsequent statistical analyses.</p>
<p>Example:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/continuous vs categorical boxplot.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Another type of analysis between 2 continuous variables is a scatterplot.</p>
<p>A scatterplot is a graphical tool used to visualize the relationship between two continuous variables. Each point on the plot represents a combination of values for the two variables, and the pattern of points can reveal the direction, strength, and form of the correlation between the variables. Scatterplots can aid in identifying potential associations between variables and provide insights into the nature of the relationship, which can inform subsequent analyses or hypotheses.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/continuous scatterplot.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="prototype-of-first-page" class="level2">
<h2 class="anchored" data-anchor-id="prototype-of-first-page">PROTOTYPE OF FIRST PAGE</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Slide1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Prototype slide 1</figcaption><p></p>
</figure>
</div>
</section>
</section>
<section id="deeper-dive" class="level1">
<h1>Deeper Dive</h1>
<p>The second section of the R-shiny apps would provide users options to experiment with other analysis types such as Multi-collinearity test and Quasi Complete Separation to identify which variables should be include or exclude when building Classification model to predict credit frauds from our data.</p>
<section id="multi--collinearity-curse" class="level2">
<h2 class="anchored" data-anchor-id="multi--collinearity-curse">Multi- Collinearity Curse</h2>
<p>Multicollinearity refers to the situation in which two or more predictor variables in a machine learning model are highly correlated with each other, making it difficult to identify the independent effects of each variable on the dependent variable.</p>
<p>In a classification model, multicollinearity can lead to unstable and unreliable estimates of the coefficients and make it difficult to interpret the model’s results. It can also lead to overfitting and reduce the model’s predictive accuracy. To address multicollinearity, one can exclude the highly correlated variables when building classification model</p>
<p>To determine whether multiple variables are in danger of compromising the model by this issue, we can utilize a correlation matrix.</p>
<p>A correlation matrix is a tool that can be used to identify multicollinearity by showing the pairwise correlations between each pair of predictor variables in the model. The correlation coefficient ranges from -1 to 1, where -1 indicates a perfect negative correlation (when one variable increases, the other decreases) and 1 indicates a perfect positive correlation (when one variable increases, the other increases).</p>
<p>In the context of multicollinearity, a high correlation coefficient (close to 1 or -1) between two predictor variables indicates a strong linear relationship between them. This means that one variable can be predicted well by the other, and it becomes difficult to disentangle the effects of the two variables on the dependent variable. It’s important to note that correlation doesn’t imply causation, and that multicollinearity can also occur between three or more predictor variables, not just pairs.</p>
<p><img src="images/multicollinearity test.PNG" width="687" height="366"></p>
</section>
<section id="quasi-complete-separation" class="level2">
<h2 class="anchored" data-anchor-id="quasi-complete-separation">Quasi Complete Separation</h2>
<p>Another issue that our Shiny Apps can allow our users to explore, is the problem with quasi complete separation. Quasi-complete separation is a situation that can occur in classification when a predictor variable perfectly separates the outcome variable into distinct categories.</p>
<p>In other words, when a predictor variable has a perfect linear relationship with the outcome variable, the logistic regression model can perfectly predict which category the outcome variable belongs to based on the value of the predictor variable. This means that the estimated coefficient for the predictor variable becomes infinitely large.</p>
<p>Quasi-complete separation is particularly problematic in small or moderate-sized datasets because it can lead to overfitting and unreliable coefficient estimates. In addition, the model’s performance can be sensitive to small changes in the data, which can make it difficult to interpret the results.</p>
<p>To address quasi-complete separation, there are several approaches that can be taken. One approach is to remove the problematic predictor variable or combine it with other variables to reduce its impact.</p>
<p>In some cases, quasi-complete separation may be a real phenomenon in the data and may require a different approach altogether. For example, if the data has a natural threshold or cutoff point, such as in medical diagnosis or credit scoring, the logistic regression model may need to be modified to account for this threshold. Overall, it’s important to be aware of quasi-complete separation and to use appropriate methods to address it when it occurs.</p>
<p>One method of visual analytics to determine whether a predictor variable has the problem of quasi complete separation is by scatterplot. Quasi-complete separation can be visualized using a scatterplot, which can help to identify the problematic predictor variable and understand its relationship with the outcome variable.</p>
<p>In a scatterplot, the predictor variable is plotted on the x-axis and the outcome variable is plotted on the y-axis. When there is quasi-complete separation, we typically see that the data points fall into two distinct groups or clusters, with no overlap between the two groups.</p>
<p><img src="images/quasi complete separation.PNG" class="img-fluid"></p>
</section>
<section id="loan-default-prediction-using-classification-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="loan-default-prediction-using-classification-algorithms">Loan default prediction using classification algorithms</h2>
<p>Upon analyzed variables identified for loan default prediction, next step is prediction. this study make use of Tidymodels library in R for prediction.</p>
<section id="tidymodels" class="level3">
<h3 class="anchored" data-anchor-id="tidymodels">Tidymodels</h3>
<p>The tidymodels framework is a collection of packages for modeling and machine learning using tidyverse principles.</p>
<p><strong><em>rsample library</em></strong></p>
<p>The rsample package provides functions to create different types of resamples and corresponding variables selected for prediction.</p>
<p><strong><em>parsnip library</em></strong></p>
<p>The goal of parsnip is to provide a tidy, unified interface to models in loan default prediction.</p>
<p><strong><em>recipes library</em></strong></p>
<p>Recipe to preprocessing data for loan default procession.</p>
<p><strong><em>yardstick library</em></strong></p>
<p>Yardstick is a package to estimate how well models are working using tidy data principles.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/prediction.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Prediction</figcaption><p></p>
</figure>
</div>
</section>
<section id="loan-type" class="level3">
<h3 class="anchored" data-anchor-id="loan-type">Loan Type</h3>
<p>The UI below provides two different loan prediction - New Loan and Repeat Loan. New loan is aim to provide prediction loan default for new customers based on various variables selected, while Repeat Loan is aim to provide prediction for existing customers based on various variables selected.</p>
<p><strong>Variables for New customers:</strong></p>
<ol type="1">
<li><em>bank_name_clients</em> : bank name</li>
<li><em>approval_duration_group</em> : approval duration grouping</li>
<li><em>age_at_loan_25th_pctile</em> : age at loan approval of 25th percentile</li>
<li><em>credit_rating</em> : borrower credict rating</li>
<li><em>termdays</em> : duration of loan</li>
<li><em>employment_status_risk</em> : employment status of borrower</li>
<li><em>level_of_education_risk</em> : education risk of borrower</li>
<li><em>referral</em> : referral</li>
<li><em>bank_account_type_recode</em> : bank account type</li>
<li><em>loanamount_group</em> : loan amount grouping</li>
<li><em>approval_duration</em> : approval duration</li>
<li><em>loanamount</em> : loan amount</li>
<li><em>totaldue</em> : total amount due of the loan</li>
<li><em>Interestrate</em> : interest rate of loan (x100)</li>
<li><em>age_at_loan</em> : age at the loan borrowed</li>
<li><em>longitude_gps</em> : customer loan</li>
<li><em>latitude_gps</em> : customer loan</li>
<li><em>bank_account_type</em> : bank account type</li>
</ol>
<p><strong>Variables for Existing customers:</strong></p>
<ol type="1">
<li><em>pct_ontime</em> : loan due one time percentile</li>
<li><em>total_ontime</em> : total no. of times loan due on time</li>
<li><em>max_active_of_loans</em> : maximum active loan borrowed</li>
<li><em>max_approval_duration</em> : maximum loan approval duration</li>
<li><em>bank_name_clients</em> : bank name of the loan borrowed</li>
<li><em>max_age_at_loan</em> : max age among all loan borrowed</li>
<li><em>avg_age_at_loan</em> : age age among all loan borrowed</li>
<li><em>employment_status</em> : employment status</li>
<li><em>bank_account_type</em> : bank account type</li>
<li><em>total_referrals</em> : total referrals of borrowed</li>
<li><em>avg_num_of_loans</em> : average number of loan borrowed</li>
<li><em>total_num_of_loans</em> : total number of loan borrowed</li>
<li><em>total_approval_duration</em> : total approval duration of all loans</li>
<li><em>mean_approval_duration</em> : average approval duration of all loans</li>
<li><em>max_interest_rate</em> : max interest rate</li>
<li><em>mean_interest_rate</em> : averahe interest rate</li>
<li><em>mean_referrals</em> : average referrals</li>
<li><em>max_churn_flag</em> : maximum loan due on time</li>
<li><em>mean_churn_flag</em> : average loan due on time</li>
<li><em>loannumber</em> : loan number</li>
<li><em>loanamount</em> : loan amount</li>
<li><em>totaldue</em> : total amount due of the loan</li>
<li><em>termdays</em> : loan duration</li>
<li><em>longitude</em> : customer location</li>
<li>*latitude** : customer location</li>
</ol>
</section>
<section id="algorithms" class="level3">
<h3 class="anchored" data-anchor-id="algorithms">Algorithms</h3>
<p>It also can use different prediction algorithms to achieve better loan default prediction accuracy based on loan type and various variables selected.</p>
<ol type="1">
<li><p>Nominal Logistic Regression</p></li>
<li><p>Fit Stepwise -Boosted Tree</p></li>
<li><p>Bootstrap Forest</p></li>
</ol>
</section>
<section id="data-sampling" class="level3">
<h3 class="anchored" data-anchor-id="data-sampling">Data Sampling</h3>
<p>This study also provide sampling method to overcome data inbalance issues. following sampling methods are provided:</p>
<ol type="1">
<li>Oversampling</li>
<li>Tomek Sampling</li>
<li>SMOTE plus Tomek Sampling</li>
</ol>
<p>The UI will enable interactive loan default prediction by selecting various variables, algorithms and sampling methods.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>